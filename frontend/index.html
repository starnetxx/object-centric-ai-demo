<!DOCTYPE html>
<html>
<head>
    <title>Object-Centric AI Demo</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; margin: 20px; }
        .container { max-width: 800px; margin: auto; }
        input[type="file"] { margin-bottom: 10px; }
        button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { opacity: 0.8; }
        #results { margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }
        .kernel-match { margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Object-Centric AI Demo</h1>
        <p>Upload an image to get object-centric insights from the model.</p>

        <input type="file" id="imageUpload" accept="image/*">
        <button onclick="predict()">Predict</button>

        <div id="results">
            <h2>Results</h2>
            <p id="status"></p>
            <div id="matchedKernels"></div>
        </div>
    </div>

    <script>
        async function predict() {
            const fileInput = document.getElementById('imageUpload');
            const statusDiv = document.getElementById('status');
            const matchedKernelsDiv = document.getElementById('matchedKernels');

            statusDiv.innerText = 'Loading...';
            matchedKernelsDiv.innerHTML = ''; // Clear previous results

            const file = fileInput.files[0];
            if (!file) {
                statusDiv.innerText = 'Please select an image file.';
                return;
            }

            // Read the file as a Base64 string
            const reader = new FileReader();
            reader.onloadend = async () => {
                const base64String = reader.result.split(',')[1]; // Get base64 data after the comma

                // Send Base64 string to the FastAPI endpoint
                const endpointUrl = 'http://localhost:8000/predict'; // FastAPI server endpoint

                try {
                    const response = await fetch(endpointUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ image_base64: base64String }),
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();

                    statusDiv.innerText = `Prediction successful! Total kernels in pool: ${data.num_kernels}`;

                    if (data.matched_kernel_ids && data.matched_kernel_ids.length > 0) {
                        let resultsHtml = '<h3>Matched Kernels:</h3>';
                        for (let i = 0; i < data.matched_kernel_ids.length; i++) {
                            resultsHtml += `<div class="kernel-match">`;
                            resultsHtml += `<p><strong>Kernel ID:</strong> ${data.matched_kernel_ids[i]}</p>`;
                            resultsHtml += `<p><strong>Similarity Score:</strong> ${data.matched_scores[i].toFixed(4)}</p>`;
                            // You could add more kernel properties here if your API returned them
                            resultsHtml += `</div>`;
                        }
                        matchedKernelsDiv.innerHTML = resultsHtml;
                    } else {
                        matchedKernelsDiv.innerHTML = '<p>No significant kernel matches found.</p>';
                    }


                } catch (error) {
                    statusDiv.innerText = `Prediction failed: ${error}`;
                    console.error('Error during prediction:', error);
                }
            };
            reader.readAsDataURL(file); // Read the file as a data URL
        }
    </script>
</body>
</html>